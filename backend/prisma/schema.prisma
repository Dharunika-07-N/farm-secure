datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  firstName     String
  lastName      String
  phone         String?
  role          Role      @default(FARMER)
  isVerified    Boolean   @default(false)
  avatarUrl     String?
  language      String    @default("en")
  address       String?
  jobTitle      String?   // e.g. "Senior Farmer", "Owner"
  
  // Notification Settings
  emailNotifications    Boolean   @default(true)
  smsNotifications      Boolean   @default(true)
  whatsappNotifications Boolean   @default(false)
  
  // Privacy Settings
  shareData             Boolean   @default(true)

  farms         Farm[]
  notifications Notification[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Farm {
  id                 String        @id @default(uuid())
  name               String
  registrationNumber String?
  location           String
  latitude           Float?
  longitude          Float?
  size               Float
  sizeUnit           String        @default("acres")
  livestockType      String?       // "Poultry", "Pig", "Mixed"
  animalCount        Int?
  establishmentDate  DateTime?
  infrastructure     String?       // JSON string or text description for now
  description        String?
  imageUrl           String?
  userId             String
  user               User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  crops              Crop[]
  transactions       Transaction[]
  inventory          Inventory[]
  alerts             Alert[]
  compliance         Compliance[]
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
}

model Crop {
  id           String     @id @default(uuid())
  name         String
  variety      String?
  plantingDate DateTime
  harvestDate  DateTime?
  status       CropStatus @default(PLANTED)
  area         Float
  farmId       String
  farm         Farm       @relation(fields: [farmId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Transaction {
  id          String          @id @default(uuid())
  type        TransactionType
  category    String
  amount      Float
  description String?
  date        DateTime
  farmId      String
  farm        Farm            @relation(fields: [farmId], references: [id], onDelete: Cascade)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}

model Inventory {
  id            String            @id @default(uuid())
  itemName      String
  quantity      Float
  unit          String
  category      InventoryCategory
  lowStockAlert Float?
  farmId        String
  farm          Farm              @relation(fields: [farmId], references: [id], onDelete: Cascade)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
}


model Alert {
  id          String   @id @default(uuid())
  title       String
  description String
  type        String   
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
  farmId      String
  farm        Farm     @relation(fields: [farmId], references: [id], onDelete: Cascade)
}

model Compliance {
  id          String   @id @default(uuid())
  name        String   
  completed   Boolean  @default(false)
  date        DateTime @default(now())
  farmId      String
  farm        Farm     @relation(fields: [farmId], references: [id], onDelete: Cascade)
}

model Outbreak {
  id              String   @id @default(uuid())
  name            String
  type            String   // avian_influenza, african_swine_fever, etc.
  latitude        Float
  longitude       Float
  severity        String   // high, medium, low
  date            DateTime
  affectedAnimals Int
  riskRadius      Float    // in km
  createdAt       DateTime @default(now())
}

model Notification {
  id          String           @id @default(uuid())
  title       String
  message     String
  type        NotificationType @default(INFO)
  severity    String?          // high, medium, low (for outbreak notifications)
  isRead      Boolean          @default(false)
  actionUrl   String?          // URL to navigate when clicked
  metadata    String?          // JSON string for additional data
  userId      String
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
}

enum Role {
  ADMIN
  FARMER
  INSPECTOR
}

enum CropStatus {
  PLANTED
  GROWING
  HARVESTED
  FAILED
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum InventoryCategory {
  SEEDS
  FERTILIZER
  PESTICIDE
  EQUIPMENT
  OTHER
}

enum NotificationType {
  INFO
  WARNING
  ALERT
  OUTBREAK
  SYSTEM
  SUCCESS
}

model TrainingModule {
  id          String   @id @default(uuid())
  name        String
  description String
  duration    Int      // in minutes
  level       String   // Beginner, Intermediate, Advanced
  category    String   // Biosecurity, Health Management, etc.
  objectives  String   // JSON array of learning objectives
  content     String   // JSON object with sections
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Disease {
  id                  String   @id @default(uuid())
  name                String   @unique
  type                String   // Viral, Bacterial, Parasitic, Fungal
  affectedSpecies     String   // JSON array of species
  symptoms            String   // JSON array of symptoms
  preventionMeasures  String   // JSON array of prevention measures
  treatment           String   // Text description of treatment
  riskLevel           String   // High, Medium, Low
  transmissionRoutes  String   // JSON array of transmission routes
  incubationPeriod    String?
  mortality           String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model DiseaseStatistic {
  id                String   @id @default(uuid())
  state             String
  year              Int
  diseaseType       String   // "Avian Influenza" or "African Swine Fever"
  deaths            Int
  outbreaks         Int
  culled            Int?     // Specific to AI
  affectedDistricts Int?     // Specific to ASF
  metadata          String?  // JSON for extras like "Virus_Strain"
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model RiskFactor {
  id                String   @id @default(uuid())
  factor            String
  asfRiskMultiplier Float
  aiRiskMultiplier  Float
  evidence          Boolean  @default(true)
  createdAt         DateTime @default(now())
}

model BiosecurityIndicator {
  id                     String   @id @default(uuid())
  indicatorId            Int      @unique
  variableName           String
  importanceWeight       Float
  evidenceSource         String
  applicableTo           String   // Both, Pig, Poultry
  poorPracticePrevalence Float
  createdAt              DateTime @default(now())
}
