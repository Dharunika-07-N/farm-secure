datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  firstName     String
  lastName      String
  phone         String?
  role          Role      @default(FARMER)
  isVerified    Boolean   @default(false)
  avatarUrl     String?
  language      String    @default("en")
  address       String?
  jobTitle      String?   // e.g. "Senior Farmer", "Owner"
  
  // Notification Settings
  emailNotifications    Boolean   @default(true)
  smsNotifications      Boolean   @default(true)
  whatsappNotifications Boolean   @default(false)
  alertRadius           Float     @default(50.0) // Preferred radius for alerts in km
  
  // Privacy Settings
  shareData             Boolean   @default(true)

  // OTP
  otp                   String?
  otpExpiresAt          DateTime?

  farms         Farm[]
  notifications Notification[]
  RiskAssessment RiskAssessment[]
  Staff         Staff[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Farm {
  id                 String        @id @default(uuid())
  name               String
  registrationNumber String?
  location           String
  latitude           Float?
  longitude          Float?
  size               Float
  sizeUnit           String        @default("acres")
  livestockType      String?       // "Poultry", "Pig", "Mixed"
  animalCount        Int?
  establishmentDate  DateTime?
  infrastructure     String?       // JSON string or text description for now
  description        String?
  imageUrl           String?
  userId             String
  user               User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  crops              Crop[]
  transactions       Transaction[]
  inventory          Inventory[]
  alerts             Alert[]
  compliance         Compliance[]
  Staff              Staff[]
  visitorLogs        VisitorLog[]
  animalBatches      AnimalBatch[]
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
}

model RiskAssessment {
  id              String   @id @default(uuid())
  score           Int
  level           String   // low, medium, high
  recommendations String   // JSON string array
  answers         String   // JSON string of all answers
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt       DateTime @default(now())
}

model Staff {
  id            String          @id @default(uuid())
  firstName     String
  lastName      String
  role          String
  phone         String?
  email         String?
  userId        String
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  farmId        String
  farm          Farm            @relation(fields: [farmId], references: [id], onDelete: Cascade)
  trainings     StaffTraining[]
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model StaffTraining {
  id               String         @id @default(uuid())
  staffId          String
  staff            Staff          @relation(fields: [staffId], references: [id], onDelete: Cascade)
  trainingModuleId String
  trainingModule   TrainingModule @relation(fields: [trainingModuleId], references: [id], onDelete: Cascade)
  completedAt      DateTime       @default(now())
  score            Int?
  status           String         @default("COMPLETED")
}

model Crop {
  id           String     @id @default(uuid())
  name         String
  variety      String?
  plantingDate DateTime
  harvestDate  DateTime?
  status       CropStatus @default(PLANTED)
  area         Float
  farmId       String
  farm         Farm       @relation(fields: [farmId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Transaction {
  id          String          @id @default(uuid())
  type        TransactionType
  category    String
  amount      Float
  description String?
  date        DateTime
  farmId      String
  farm        Farm            @relation(fields: [farmId], references: [id], onDelete: Cascade)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}

model Inventory {
  id            String            @id @default(uuid())
  itemName      String
  quantity      Float
  unit          String
  category      InventoryCategory
  lowStockAlert Float?
  farmId        String
  farm          Farm              @relation(fields: [farmId], references: [id], onDelete: Cascade)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
}


model Alert {
  id          String   @id @default(uuid())
  title       String
  description String
  type        String   
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
  farmId      String
  farm        Farm     @relation(fields: [farmId], references: [id], onDelete: Cascade)
}

model Compliance {
  id            String           @id @default(uuid())
  name          String
  description   String?
  status        ComplianceStatus @default(NOT_STARTED)
  notes         String?
  dueDate       DateTime?
  attachmentUrl String?          // For evidence photos/documents
  date          DateTime         @default(now())
  farmId        String
  farm          Farm             @relation(fields: [farmId], references: [id], onDelete: Cascade)
}

enum ComplianceStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  EXPIRED
}

model Outbreak {
  id              String   @id @default(uuid())
  name            String
  type            String   // avian_influenza, african_swine_fever, etc.
  latitude        Float
  longitude       Float
  severity        String   // high, medium, low
  date            DateTime
  affectedAnimals Int
  riskRadius      Float    // in km
  createdAt       DateTime @default(now())
}

model Notification {
  id          String           @id @default(uuid())
  title       String
  message     String
  type        NotificationType @default(INFO)
  severity    String?          // high, medium, low (for outbreak notifications)
  isRead      Boolean          @default(false)
  actionUrl   String?          // URL to navigate when clicked
  metadata    String?          // JSON string for additional data
  userId      String
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
}

enum Role {
  ADMIN
  FARMER
  INSPECTOR
}

enum CropStatus {
  PLANTED
  GROWING
  HARVESTED
  FAILED
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum InventoryCategory {
  SEEDS
  FERTILIZER
  PESTICIDE
  EQUIPMENT
  OTHER
}

enum NotificationType {
  INFO
  WARNING
  ALERT
  OUTBREAK
  SYSTEM
  SUCCESS
}

model TrainingModule {
  id          String   @id @default(uuid())
  name        String
  description String
  duration    Int      // in minutes
  level       String   // Beginner, Intermediate, Advanced
  category    String   // Biosecurity, Health Management, etc.
  objectives  String   // JSON array of learning objectives
  content     String   // JSON object with sections
  isActive    Boolean  @default(true)
  trainings   StaffTraining[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Disease {
  id                  String   @id @default(uuid())
  name                String   @unique
  type                String   // Viral, Bacterial, Parasitic, Fungal
  affectedSpecies     String   // JSON array of species
  symptoms            String   // JSON array of symptoms
  preventionMeasures  String   // JSON array of prevention measures
  treatment           String   // Text description of treatment
  riskLevel           String   // High, Medium, Low
  transmissionRoutes  String   // JSON array of transmission routes
  incubationPeriod    String?
  mortality           String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model AnimalBatch {
  id              String         @id @default(uuid())
  batchNumber     String         @unique
  species         String         // Poultry, Pig
  breed           String?
  quantity        Int
  arrivalDate     DateTime
  source          String?
  status          String         @default("ACTIVE") // ACTIVE, SOLD, CULLED, DECEASED
  farmId          String
  farm            Farm           @relation(fields: [farmId], references: [id], onDelete: Cascade)
  movements       MovementLog[]
  mortality       MortalityRecord[]
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
}

model MovementLog {
  id            String      @id @default(uuid())
  batchId       String
  batch         AnimalBatch @relation(fields: [batchId], references: [id], onDelete: Cascade)
  type          String      // INTERNAL, EXTERNAL_IN, EXTERNAL_OUT
  fromLocation  String?
  toLocation    String?
  quantity      Int
  date          DateTime    @default(now())
  reason        String?
  createdAt     DateTime    @default(now())
}

model VisitorLog {
  id                String   @id @default(uuid())
  visitorName       String
  organization      String?
  purpose           String
  phone             String?
  entryTime         DateTime @default(now())
  exitTime          DateTime?
  biosecurityPass   Boolean  @default(false)
  disinfected       Boolean  @default(false)
  farmId            String
  farm              Farm     @relation(fields: [farmId], references: [id], onDelete: Cascade)
  createdAt         DateTime @default(now())
}

model MortalityRecord {
  id          String      @id @default(uuid())
  batchId     String
  batch       AnimalBatch @relation(fields: [batchId], references: [id], onDelete: Cascade)
  quantity    Int
  cause       String?     // Disease name or "Unknown"
  date        DateTime    @default(now())
  symptoms    String?
  notes       String?
  createdAt   DateTime    @default(now())
}

model DiseaseStatistic {
  id                String   @id @default(uuid())
  state             String
  year              Int
  diseaseType       String   // "Avian Influenza" or "African Swine Fever"
  deaths            Int
  outbreaks         Int
  culled            Int?     // Specific to AI
  affectedDistricts Int?     // Specific to ASF
  metadata          String?  // JSON for extras like "Virus_Strain"
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model RiskFactor {
  id                String   @id @default(uuid())
  factor            String
  asfRiskMultiplier Float
  aiRiskMultiplier  Float
  evidence          Boolean  @default(true)
  createdAt         DateTime @default(now())
}

model BiosecurityIndicator {
  id                     String   @id @default(uuid())
  indicatorId            Int      @unique
  variableName           String
  importanceWeight       Float
  evidenceSource         String
  applicableTo           String   // Both, Pig, Poultry
  category               String   @default("General") // e.g., "Personnel", "Animal Movement", etc.
  poorPracticePrevalence Float
  createdAt              DateTime @default(now())
}
